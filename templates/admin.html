<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Admin Panel</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				padding: 20px;
				background: #f9f9f9;
			}
			h2 {
				color: #333;
			}
			table {
				width: 100%;
				border-collapse: collapse;
				margin-top: 20px;
				background: #fff;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
			}
			th,
			td {
				padding: 12px;
				border-bottom: 1px solid #ddd;
				text-align: left;
			}
			th {
				background-color: #f0f0f0;
			}
			button {
				background-color: #e74c3c;
				color: #fff;
				border: none;
				padding: 6px 12px;
				cursor: pointer;
				border-radius: 4px;
			}
			button:hover {
				background-color: #c0392b;
			}

			/* Loading overlay */
			#loading {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.4);
				display: flex;
				align-items: center;
				justify-content: center;
				z-index: 9999;
			}
			#loading div {
				width: 50px;
				height: 50px;
				border: 5px solid #f3f3f3;
				border-top: 5px solid #3498db;
				border-radius: 50%;
				animation: spin 1s linear infinite;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}
		</style>
	</head>
	<body>
		<h2>Connected Devices</h2>

		<table>
			<thead>
				<tr>
					<th>Client Name</th>
					<th>Hostname</th>
					<th>IP Address</th>
					<th>MAC Address</th>
					<th>Action</th>
				</tr>
			</thead>
			<tbody id="device-table"></tbody>
		</table>

		<div id="loading"><div></div></div>

		<script>
			const loading = document.getElementById("loading");
			let firstResponse = false;

			async function loadDevices() {
				if (!firstResponse) {
					loading.style.display = "flex";
				}

				try {
					const res = await fetch("/admin/data");
					const data = await res.json();

					const tbody = document.getElementById("device-table");
					tbody.innerHTML = "";

					if (!firstResponse) {
						firstResponse = true;
						loading.style.display = "none";
					}

					data.devices.forEach((d) => {
						const tr = document.createElement("tr");
						tr.innerHTML = `
							<td>${d.name || "Unknown"}</td>
							<td>${d.hostname || "Unknown"}</td>
							<td>${d.ip}</td>
							<td>${d.mac}</td>
							<td><button onclick="kick('${d.ip}')">Kick</button></td>
						`;
						tbody.appendChild(tr);
					});
				} catch (err) {
					console.error(err);
				}
			}

			async function kick(ip) {
				if (!confirm(`Kick device ${ip}?`)) return;
				await fetch(`/admin/kick/${ip}`, { method: "POST" });
				loadDevices();
			}

			loadDevices();
			setInterval(loadDevices, 5000);
		</script>
	</body>
</html>
